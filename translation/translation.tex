\documentclass[12pt]{article}

% format
% \usepackage[a4paper, total={6in, 9in}]{geometry}                         

% math symbols
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage[shortlabels]{enumitem} 
\usepackage{mathtools}
\usepackage{bbm}

% annotations
\usepackage{todonotes}
\usepackage{pdfcomment}

% figures
\usepackage{graphicx}
\usepackage{subcaption}

% theorems
\theoremstyle{definition}
\newtheorem{thm}{Theorem}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{defn}[thm]{Definition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{exo}[thm]{Exercise}
\newtheorem{fact}[thm]{Fact}

% definition equal
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\eqdef}{=\vcentcolon}
\pdfcommentsetup{color=yellow, opacity=0.5}

% bibliography
\usepackage[backend=biber,style=alphabetic, sorting=ynt]{biblatex}

% url highlight
\usepackage{hyperref}

% algos
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\SetArgSty{textnormal}

% bullet point style
\renewcommand{\labelitemi}{\tiny$\blacksquare$}

% new commands
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\Hess}{\textbf{H}}
\DeclareMathOperator{\Diag}{Diag}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\ind}{i}
\DeclareMathOperator{\sgn}{sign}

\begin{document}

    \section{Coloring circle graphs}
    
    \textbf{WARNING}: intervals
    $h_1$, $h_2$ overlap if
    $h_1 \cap h_2 \neq \emptyset$,
    $h_1 \not \subseteq h_2$ and
    $h_2 \not \subseteq h_1$.
    \vspace{4pt}

    We look at the class
    of circle graphs as the class
    of overlap graphs of intervals on a line.
    Without loss of generality,
    \pdfmarkupcomment{we only consider the interval
    models containing open intervals}
    {I am assuming opennes}
    in which no two intervals
    share an endpoint.

    For any such family of intervals
    $F$ and any point $c$ on a line,
    we set $F^{-}\left(c\right) \defeq
    \left\{\left(a, b\right) \in F
    \middle| b < c\right\}$,
    $F^{0}\left(c\right) \defeq
    \left\{\left(a, b\right)
    \middle| a < c < b\right\}$,
    $F^{+}\left(c\right) \defeq
    \left\{\left(a, b\right)
    \middle| c < a\right\}$.
    If $\omega\left(F\right) = 2$,
    for all $\left(a, b\right) \in F$,
    we have that
    $F^{0}\left(a\right) \setminus F^{0}\left(b\right)$ 
    and $F^{0}\left(b\right) \setminus F^{0}\left(a\right)$
    only contain nested intervals.
    Otherwise, if we had two
    overlapping intervals $h_1, h_2 \in
    F^{0}\left(a\right) \setminus F^{0}\left(b\right)$,
    we would have $h_1, h_2, \left(a, b\right)$ 
    forming a triangle.

    \begin{lemma} \label{lemma:4.4}
        Let $F$ be the interval
        model of a circle graph.
        Suppose that $\omega\left(F\right) = 2$ 
        and that for no two
        $h_1, h_2 \in F$,
        there exists $h_3 \in F$ 
        with $h_3 \in h_1 \cap h_2$.
        Then, there exists a 3-coloring
        of $F$ such that 
        \pdfmarkupcomment{for all
        $\left(a, b\right) \in F$, 
        the intervals in $F^{0}\left(b\right) 
        \setminus F^{0}\left(a\right)$
        have the same color.}
        {I guess that the remarkable
        result is the 3-coloring
        part}
    \end{lemma}
    \begin{proof}
        By way of contradiction,
        suppose that the statement is incorrect
        and let $F = \left\{h_{i}\right\}_{i = 1}^{n} =
        \left\{\left(a_{i}, b_{i}\right)\right\}_{i = 1}^{n}$
        be the counterexample
        to this lemma with the
        least cardinality.
        Clearly, \pdfmarkupcomment{$G\left(F\right)$ is 
        connected.}{if G(F) was
        not connected, at least one
        of its connected components
        would countervene to the lemma
        and we would have a smaller
        counterexample}
        Let $\left(a_1, b_1\right),
        \ldots, \left(a_{t}, b_{t}\right)$,
        with $a_1 < \ldots < a_{t}$,
        be the intervals of $F$ which
        are not contained in any other 
        intervals. Notice that we have
        $F^{0}\left(a_{1}\right) = 
        F^{-}\left(a_1\right) = \emptyset$.
        Suppose that $\left|F^{0}\left(b_1\right)\right| \leq 1$.
        By the minimality of $F$,
        we get that the interval
        model $F' \defeq F \setminus \left\{h_{1}\right\}$ 
        is 3-colorable. It is clear
        that coloring $h_1$ with a different
        color from $h_2$, we obtain a coloring
        for $F$. Which contradicts the fact
        that $F$ is a counterexample to this lemma.
        Therefore, we conclude that $\left|F^{0}\left(b_1\right)\right| \geq 2$ 
        and $t \geq 2$.

        By the connectedness of $G\left(F\right)$,
        we have $h_{i} \cap h_{i+1} \neq \emptyset$ 
        for all $i \in \left\{1, \ldots, t -1\right\}$.
        Let us show that 
        \pdfmarkupcomment{for all
        $i \in \left\{1, \ldots, t - 1\right\}$
        we have
        $F^{-}\left(b_{i}\right) = \emptyset$ 
        or $F^{+}\left(a_{i+1}\right) = \emptyset$.}{That would imply
        that i = 1 or i = t 
        for all i in
        {1, \ldots, t}
        and so t <= 2}
        Suppose that this does not
        hold for some $1 \leq i \leq t - 1$.
        Let $F_1 = F \setminus F^{+}\left(a_{i+1}\right)$
        and $F_2 = F \setminus F^{-}\left(b_{i}\right)$.
        
        We claim that $F_1 \cap F_2 = 
        \left\{h_{i}, h_{i+1}\right\}$.
        Indeed, $h_{j} \in 
        F_1 \cap F_2$, 
        iff $a_{j} \leq a_{i+1}$ 
        and $b_{j} \geq b_{i+1}$.
        Clearly $h_{i}$ and
        $h_{i+1}$ have this
        property.
        Now, suppose that there
        exists $h_{j} \in F_1 \cap F_2$
        such that $a_{j} < a_{i+1}$
        and $b_{j} > b_{i+1}$.
        We cannot have $a_{j} < a_{i}$,
        because otherwise $h_{i} \subseteq h_{j}$.
        Similarly, we cannot have $b_{j} > b_{i+1}$,
        because otherwise, we would
        have $h_{i+1} \subseteq h_{j}$.
        Therefore we have $a_{i} < a_{j}$ 
        and $b_{j} < b_{i+1}$.
        The only remaining case is
        that of $a_{i} < a_{j} < a_{i+1}$ 
        and $b_{i} < b_{j} < b_{i+1}$.
        But if this is the case,
        $\left\{h_{i}, h_{j}, h_{i+1}\right\}$ would
        form a triangle, which
        contradicts our assumptions.
        
        In view of the minimality of
        $F$, there exist 3-colorings
        $f_1$, $f_2$ of $F_1$ and $F_2$ as required
        by the statement of this lemma
        with colors 1, 2 and 3 (here
        we use our assumption that
        $F^{-}\left(b_{i}\right)$ 
        and $F^{+}\left(a_{i+1}\right)$ 
        are non-empty and thus
        $F_{1}$ and $F_{2}$ are
        strictly smaller than $F$).
        Since $h_1$ and $h_2$ overlap,
        they have different colors
        both in $f_1$ and $f_2$, therefore,
        we can assume without loss of 
        generality that
        $f_1\left(h_{i}\right) = f_2\left(h_{i}\right) = 1$
        and $f_{1}\left(h_{i+1}\right) = 
        f_2\left(h_{i+1}\right) = 2$.
        Let
        \begin{equation*}
            f\left(h\right) = 
            \begin{cases}
                f_1\left(h\right) &\text{ if } h \in F_1, \\
                f_2\left(h\right) &\text{ if } h \in F_{2}.
            \end{cases}
        \end{equation*}
        We verify that $f$ 
        is a coloring of $F$. Let
        $h' = \left(a', b'\right) \in F$,
        $h'' = \left(a'', b''\right) \in F$
        with $a' < a'' < b' < b''$.
        If $\left\{h', h''\right\} \subseteq F_1$ 
        or $\left\{h', h''\right\} \subseteq F_2$,
        then $f\left(h'\right) \neq 
        f\left(h''\right)$.
        If $h' \in F^{-}\left(b_{i}\right)$ 
        and $h'' \in F^{+}\left(a_{i+1}\right)$
        then, by assumption
        we have
        $h', h'' \not \subseteq \left(a_{i+1}, b_{i}\right)$,
        and so we must have $a' < a_{i+1} < 
        a'' < b' < b_{i} < b''$. 
        Since $f_2$ is a coloring,
        we have $f\left(h''\right) =
        f_2\left(h''\right) =
        f_2\left(h_{i+1}\right) = 2$.
        Since $h'$ overlaps with $h_{i+1}$
        and $h', h_{i+1}
        \in F_1$, then $f\left(h'\right)
        \neq 2 = f\left(h''\right)$.
        \pdfcomment[icon=Note, color=yellow]
        {So far we proved that
        the colorings f1 and 
        f2 can be fused into 
        one coloring f.}
        Similarly, 
        \pdfmarkupcomment{we can verify
        that for all $\left(a, b\right) \in F$
        all intervals in $F\left(b\right)
        \setminus F\left(a\right)$
        have the same color.} 
        Thus
        $f$ is a 3-coloring of $F$,
        which contradicts our choice of $F$.
        \pdfmarkupcomment{
        Thus, we have that
        $F^{-}\left(b_{i}\right) = \emptyset$ and
        $F^{+}\left(a_{i+1}\right) = \emptyset$
        for all $i \in \left\{1, \ldots, t-1\right\}$.}
        {Now that we have this
        why do we go on?}

        We have $\left|F^{+}\left(a_{2}\right)\right| \geq
        \left|F^{0}\left(b_1\right)\right| \geq 2$,
        and, since $F^{-}\left(b_1\right) = \emptyset$,
        we have $F^{0}\left(a_2\right)
        = \left\{h_1\right\}$.
        
        If $F^{0}\left(b_2\right) = \emptyset$,
        i.e. $t=2$, then $h_2$
        only overlaps with $h_1$.
        A coloring $h_2$ with the color
        of the elements of $F^{0}\left(b_1\right)
        \setminus \left\{h_2\right\}$,
        we obtain a 3-coloring of $F$ with
        the conditions required by
        the present lemma, which is a
        contradiction.
        
        If $F^{0}\left(b_2\right) \neq \emptyset$
        and $t \geq 3$,
        we obtain (since $h_1 \in
        F^{-}\left(b_2\right)$)
        theat $F^{+}\left(a_3\right)=\emptyset$ 
        and thus $t=3$
        and $F^{0}\left(b_2\right) = \left\{h_3\right\}$.
        Consider $F \setminus \left\{h_2\right\}$.
        Since $F$ is minimal,
        we find that there exists
        a coloring $f$ of $F \setminus \left\{h_2\right\}$
        which follows the requirement
        of the present lemma.
        Let $h_2' = \left(a_2', b_2'\right)$
        be the longest interval of 
        $F^{0}\left(b_1\right) \setminus \left\{h_2\right\}$
        (which exists since $\left|F^{0}\left(b_1\right)\right|
        \geq 2$). This way
        $h_2'$ contains all
        the intervals in
        $F^{0}\left(b_1\right)$.
        Now, assume that $f\left(h_1\right) = 1$
        and $f\left(h_2'\right) = 2$.
        If $f\left(h_3\right)\neq 2$,
        then we have a coloring 
        of $F$ with the properties
        required by the present lemma.
        Which yields a contradiction.
        If $f\left(h_3\right) = 2$,
        then $h_3$ and $h_2'$
        do not overlap. Thus $h_3 \in F^{+}\left(b_2'\right)$.
        By assumption, all intervals
        of $F^{0}\left(b_2'\right)$ 
        are colored with the same color
        $\gamma \in \left\{1,3\right\}$.
        By recoloring all elements
        of $F^{+}\left(b_2'\right)$
        of color 2 to color 
        $\delta \in \left\{1,3\right\}
        \setminus \gamma$
        and all elements of $F^{+}\left(b_2'\right)$ 
        of color $\delta$ with color 2,
        \pdfmarkupcomment{
        we obtain a 
        new coloring $f'$ of 
        $F \setminus \left\{h_2\right\}$.} 
        {We essentially flip 2 and delta,
        if there was no conflict
        before, there is no conflict
        now} 
        \pdfmarkupcomment{Since $h_3 \in F^{+}\left(b_2'\right)$}
        {since h2' and h3 do not
        overlap}, we get
        $f'\left(h_2'\right)=2$ and
        $f'\left(h_3\right) \neq 2$.
        By coloring $h_2$ with
        color 2, 
        \pdfmarkupcomment{we obtain a coloring
        of $F$ with the properties
        required by the present lemma.}
        {this is because F0(a2)
        = {h1} and
        F0(b2) = {h3}}
    \end{proof}
    
    For each pair of overlapping
    intervals $h_1, h_2 \in F$,
    let $p\left(h_1, h_2\right)
    = h_1 \cap h_2$.
    We denote by $P\left(F\right)$ 
    the family of such intersections.
    Let $P^{0}\left(F\right) \subseteq 
    P\left(F\right)$ be the
    inclusion-wise maximal family
    of $P\left(F\right)$.

    \begin{lemma} \label{lemma:4.5}
        Let $F$ be a family of
        intervals with $\omega\left(F\right)=2$.
        Then, the intervals of $P^{0}\left(F\right)$ 
        do not intersect.
    \end{lemma}
    \begin{proof}
        \pdfmarkupcomment{
        Let $p_1=h_1 \cap h_2 \in 
        P^{0}\left(F\right)$ and
        $p_2=h_3 \cap h_4 \in P^{0}\left(F\right)$.}
        {Possibly h3=h2}
        Therefore, $\left(p_1 \cap p_2\right) =
        \left(a_4, b_1\right)$.
        So $a_1 < a_2 < a_4
        < b_1 <b_3 < b_4$.
        If $b_2 < b_4$,
        then $h_1, h_2, h_4$ 
        pairwise overlap. 
        Thus we have a triangle,
        which is a contradiction.
        Thus $b_4 < b_2$.
        By a symmetric argument
        we get $a_1 < a_3$.
        But then $p_2 =
        \left(a_4, b_3\right)
        \subsetneq \left(a_2, b_1\right)
        = p_1$ which contradicts
        the maximality of $p_2$.
    \end{proof}
    \begin{thm}
        Let $F$ be a family of intervals
        with $\omega\left(F\right)=2$.
        $\chi\left(F\right) \leq 5$.         
    \end{thm}        
    \begin{proof}
        \pdfmarkupcomment{
        We construct the desired
        coloring by induction
        on $k$.}
        {k is the 
        number of ``layers''}
        Let $k = 1$.
        Let $F_1$ be the subset
        of intervals of $F$ that 
        do not lie in the intersection
        of overlapping intervals of $F$.
        By Lemma \ref{lemma:4.4},
        there exists a coloring
        $f_1$ of $F_1$ with colors
        $\left\{1,2,3\right\}$ such
        that for every $\left(a,b\right)
        \in F_1$, the intervals
        of the family $F^{0}_{1}
        \left(b\right) \setminus F^{0}\left(a\right)$
        are colored with the same
        color.
        By Lemma \ref{lemma:4.5},
        the intervals of the family
        $P^{0}\left(F_1\right)$ 
        do not overlap. By definition
        of $F_1$, each interval in 
        $F \setminus F_1$ is contained
        in some (maximal) intersection
        $p \in P^{0}\left(F_1\right)$.
        Consider that the following
        construction has been done
        for $k - 1$ with $k \geq 2$.
        We want the following properties
        to be true.
        \begin{enumerate}
            \item The intervals in
                $F' \defeq 
                \bigcup_{i=1}^{k-1} F_{i}$
                \pdfmarkupcomment{
                (where the $F_{i}$s
                might not be disjoint)}
                {Aren't they?
                No. As we will see later
                we will have the intervals
                ht+1, ..., hs
                which are in F' 
                but also in Fp,k.}
                are colored with colors
                $\left\{1, \ldots, 5\right\}$.
            \item \pdfmarkupcomment{
                The intervals in
                $F \setminus F'$ do not
                overlap with intervals
                in $\bigcup_{i=1}^{k-2}
                F_{i} \setminus F_{k-1}$.}
                {Otherwise omega(F)
                >= 3}
                \label{cond:2}
            \item \label{cond:3} All intervals in 
                $F \setminus F'$ 
                \pdfmarkupcomment{
                are contained in some 
                interval $p \in 
                P^{0}\left(F^{k-1}\right)$.}
                {For k = 1, this is
                Lemma 2}
            \item For each $p =
                \left(c, d\right) \in 
                P^{0}\left(F_{k-1}\right)$ 
                either only one
                color is used to color
                all intervals in 
                $F^{0}_{k-1}\left(c\right) 
                \setminus F^{0}_{k-1}\left(d\right)$,
                and no more than 
                two colors are used to 
                colors intervals
                of $F^{0}_{k-1}\left(d\right)
                \setminus F^{0}_{k-1}\left(c\right)$
                or viceversa.
        \end{enumerate}
        Let us show how to carry out the 
        $k$-th step of this construction.
        If $F \setminus F' = \emptyset$,
        then we are done and we have 
        the desired coloring.
        Consider any interval
        $p = \left(c, d\right)
        \in P^{0}\left(F_{k-1}\right)$,
        \pdfmarkupcomment{
        which contains at least one interval
        of $F \setminus F'$.} 
        {By condition 3}
        Let
        \begin{align*}
            F^{0}_{k-1}\left(c\right) \setminus 
            F^{0}_{k-1}\left(d\right)
            &= \left\{h_{j}\right\}_{j=1}^{t}
            = \left\{\left(c_{j},
            d_{j}\right)\right\}_{j=1}^{t} \\
            F^{0}_{k-1}\left(d\right) \setminus 
            F^{0}_{k-1} \left(c\right)
            &= \left\{h_{j}\right\}_{j=t+1}^{s}
            = \left\{\left(c_{j},
            d_{j}\right)\right\}_{j=t+1}^{s},
        \end{align*}
        and $p = \left(c_{s}, d_{s}\right)
        \cap \left(c_{t}, d_{t}\right) = 
        \left(c_{s}, d_{t}\right)$.
        As already noted, 
        \pdfmarkupcomment{each
        family consists of
        nested intervals.}
        {Otherwise omega(F) >= 3}
        Without loss of generality,
        suppose that
        $\gamma_1 \in \left\{1, 3\right\}$
        is the color used to
        color the intervals
        $h_{t+1}, \ldots, h_{s}$
        and 
        \pdfmarkupcomment{let $\gamma_{2}, \gamma_{3}$}
        {Could also be only gamma2}
        be the colors used to 
        color
        $\left\{h_1, \ldots h_t\right\}$.
        
        Let $I_{p}$ be the
        set of intervals in $F$ 
        contained in $p$,
        the intervals $h_{t+1},
        \ldots, h_{s}$ and the 
        interval 
        $\left(d, d_{s} + 1\right)$.
        Let $F_{k, p}$ be 
        the set of intervals in $I_{p}$ 
        which are not contained in
        the overlap of any two
        intervals in $I_{p}$. 

        Let us show that the 
        intervals from $I_{p}
        \setminus F_{k, p}$ 
        \pdfmarkupcomment{do 
        not overlap with 
        any of the intervals of
        $F' \setminus \left\{
        h_{t+1},\ldots,h_{s}\right\}$.}
        {The following
        levels can only 
        overlap with 
        {ht+1,
        ..., hs}}
        By condition \ref{cond:2}
        of our induction hypothesis, 
        intervals from
        $F' \setminus \left\{h_{t+1},
        \ldots, h_{s}\right\}$
        that can overlap with 
        elements in $I_{p} \setminus 
        F_{k,p}$ 
        \pdfmarkupcomment{are only intervals
        in $\left\{h_1, \ldots, h_{t}\right\}$.}
        {This is true for intervals
        overlapping with p, but what
        about intervals overlapping
        with d?
        The only intervals in
        Ip overlapping
        with (d, ds + 1) 
        are ht+1,...,
        hs which are
        also in Fk,p.}
        Let $\left(a_1, b_1\right) \in I_{p}$ 
        be an interval contained in the
        overlapping of
        $\left(a_2, b_2\right), 
        \left(a_3, b_3\right)
        \in I_{p}$ and thus
        overlapping with some
        $h_{j} =\left(c_{j}, d_{j}\right)$ 
        for $1 \leq j \leq t-1$.
        Then $a_{i} > c_{s}$ for
        all $i \in \left\{1, 2, 3\right\}$.
        We also get $c_{j} < c_{s}$,
        $a_1 < d_{j} < b_1$. Hence
        $h_{j}$, $\left(a_2, b_2\right)$ 
        and $\left(a_3, b_3\right)$ 
        pairwise overlap.
        Which is a contradiction.

        If $p$ contains at least one interval,
        then $F_{k, p} \setminus \left(h_{t+1},
        \ldots, h_{s}\right) \cup 
        \left\{\left(d, d_{s} + 1\right)\right\}
        \neq \emptyset$.
        By Lemma \ref{lemma:4.4}
        (replacing $F^{0}\left(b\right)
        \setminus F^{0}\left(a\right)$
        with $F^{0}\left(a\right)
        \setminus F^{0}\left(b\right)$),
        we can color $F_{k, p}$ 
        with colors from
        $\left\{1,2,3,4,5\right\} \setminus 
        \left\{\gamma_2, \gamma_3\right\}$
        such that
        for each
        $\left(a, b\right) \in 
        F_{k, p}$,
        the interval from
        $F^{0}_{k, p}\left(a\right) \setminus 
        F^{0}_{k, p}\left(b\right)$
        have the same color.
        At the same time,
        \pdfmarkupcomment{since $\left\{h_{t+1},
        \ldots, h_{s}\right\}
        = F^{0}_{k, p}\left(d\right)
        \setminus F^{0}\left(d_{s} + 1\right)$}
        {Actually 
        F0(ds + 1) 
        is empty, but we want
        to apply the statement
        of Lemma 1
        rigorously. This
        is why we introduce
        the segment (d, ds + 1) 
        in the first place.}
        we can assume that 
        $h_{t+1}, \ldots,
        h_{s}$ is colored 
        with (only) $\gamma_1$.
        
        Let us denote $F_{k, p}' = 
        F_{k, p} \setminus \left\{
        \left(d, d_{s} + 1\right)\right\}$.
        It is easy to see that the coloring of
        $F_{k, p}'$ is compatible
        with that of
        $F'$.
        Carrying out similar constructions
        for each $p \in P^{0}\left(F_{k-1}\right)$
        containing at least one uncolord
        interval of $F$, let
        $F_{k} \defeq \bigcup_{p \in 
        P^{0}\left(F_{k-1}\right)} F_{k, p}'$.

        One can check that the 
        induction hypotheses hold
        for $k$.
        Also, the number of uncolored
        vertices strictly decreseas 
        at each step. Therefore
        the coloring will be 
        completed in a finite
        number of iterations.
    \end{proof}
    
    \section{Coloring polygon circle graphs}

    We define polygon circle
    graphs as the set of intersection
    graphs of polygons
    (including segments)
    inscribed in a circle.
    For the sake of simplicity,
    we will only consider
    families of polygons
    in which no two
    vertices coincide.
    The class of circle
    graphs can be obtained
    by restricting the
    choice of polygons
    to segments.

    Like circle graphs, we
    handle polygon
    circle graphs by looking
    at the stereographic projection
    of the circle onto $\mathbb{R}$.
    Thus, a polygon circle
    graph is represented by a 
    family $\left\{h_{i}\right\}_{i=1}^{n}$
    with 
    $\left(a_{1}^{\left(i\right)},
    \ldots, a_{k_{i}}^{\left(i\right)}\right)$ 
    for some $k_{i} \geq 1$ 
    with $a^{\left(i\right)}_{j} \in \mathbb{R}$
    being the image of
    the stereographic projection
    of a vertex of $h_{i}$.

    Given a familiy
    $F = \left\{h_{i}\right\}_{i=1}^{n}$ 
    of polygons, we denote
    the corresponding
    intersection graph $G\left(F\right)$.
    By abuse of notation,
    we will denote
    $\omega\left(G\left(F\right)\right)$ 
    by $\omega\left(F\right)$.
    Given two polygons
    $h_{i}, h_{i'}$ in $F$,
    we say that $h_{i}$ and
    $h_{i'}$ overlap 
    if there exists indices 
    $j$ and $j'$ such that
    $\left(a_{j}^{\left(i\right)},
     a_{j+1}^{\left(i\right)}\right)$ 
     and $\left(a_{j'}^{\left(i'\right)},
     a_{j'+1}^{\left(i'\right)}\right)$ 
     overlap.

     Given a polygon
     $h \defeq \left(
     a_{1}, \ldots, a_{k}\right)$,
     a contraction of $h$,
     is a polygon $h'$ 
     of the form
     $\left(a_{1}, \ldots,
     a_{i-1}, a_{i+1}, \ldots
     a_{k}\right)$ 
     where indices are
     unerstood modulo $k$.
     Consider a family of
     polygons
     $F = \left\{h_{i}\right\}_{i=1}^{n}$.
     Let $F'$ be the family
     of polygons generated
     by contracting one
     polygon in $F$.
     We define the partial order
     `$\prec$' on the set
     of polygon circle graphs
     to be the order generated
     by the relations $F' \prec F$.
     Notice that $\prec$ is
     well-founded since,
     if $F' \prec F$,
     the total number of 
     vertices of polygons in
     $F'$ is strictly less than
     that of the polygons in $F$.

     Let $c \in \mathbb{R}$.
     We establish the following notation.
     \begin{gather*}
         F^{0}\left(c\right) \defeq
         \left\{h_{i} \in F \middle|
         a_{1}^{\left(i\right)}
         < c < a_{k_{i}}^{\left(i\right)}\right\}, \\
         \widetilde{F}^{0}\left(a_{j}^{\left(i\right)}\right)
         \defeq \left\{
         h_{i'} \in F \middle|
         a_{1}^{\left(i\right)} < a_{j'}^{\left(i'\right)}
         < a_{j}^{\left(i\right)}
         < a_{j'+1}^{\left(i'\right)}
         \text{ for some }
         1 \leq j' < k_{i'} \right\},\\
         F^{+}\left(c\right) \defeq
         \left\{h_{i} \in F \middle|
         c < a_{1}^{\left(i\right)}\right\},\\
         F^{-}\left(c\right) \defeq
         \left\{h_{i} \in F
         \middle| a_{k_{i}}^{\left(i\right)} < c\right\}.
     \end{gather*}
     For any $h_{i} \in F^{0}\left(c\right)$,
     denote $I_{c}\left(h_{i}\right)
     \defeq \left(a_{j}^{\left(i\right)},
     a_{j+1}^{\left(i\right)}\right)$ 
     such that $c \in 
     \left(a_{j}^{\left(i\right)},
     a_{j+1}^{\left(i\right)}\right)$ 
     and $O_{c}\left(h_{i}\right)
     \defeq \left(a_{1}^{\left(i\right)},
     a_{k_{i}}^{\left(i\right)}\right)$.
     For any polygon $h_{i}$,
     we call the segment
     $\left(a_{1}^{\left(i\right)},
     a_{k_{i}}^{\left(i\right)}\right)$
     the external
     segment of $h_{i}$.

     Also, for any two polygons
     $h_{i}$, $h_{i'}$ be two
     polygons whose external segments
     overlap with
     $a_1^{\left(i\right)} < a_1^{\left(i'\right)}$.
     Let $\left(a_{j}^{\left(i\right)},
     a_{j+1}^{\left(i\right)}\right) =
     I_{a_1^{\left(i'\right)}}\left(h_{i}\right)$
     and let
     $b^{\left(i, i'\right)} \defeq a_{j+1}^{\left(i\right)}$.
     Let $\left(a_{j'}^{i'}, a_{j'+1}^{\left(i'\right)}\right)
     = I_{b^{\left(i,i'\right)}}\left(h_{i'}\right)$ 
     and let $a^{\left(i',i\right)}
     \defeq a_{j'}^{\left(i'\right)}$.

     Consider the set of intervals
     of the form $\left(a^{\left(i',i\right)},
     b^{\left(i,i'\right)}\right)$ 
     and denote it $P\left(F\right)$.
     Take the inclusion-wise maximal
     subfamily of such intervals
     and denote it $P^{0}\left(F\right)
     \subseteq P\left(F\right)$.
     
     \begin{rmk}
         Notice that, if 
         $\omega\left(F\right) = 2$,
         the maximality of
         $P^{0}\left(F\right)$ 
         implies that all the
         intervals in $P^{0}\left(F\right)$
         are disjoint.
     \end{rmk}

     From now on, consider
     $F = \left\{h_{i}\right\}_{i = 1}^{n}$ 
     be a family of polygons
     with $\omega\left(F\right)=2$.
     We have the following two facts.

     \begin{fact}
         For any $\left(a_{j}^{\left(i\right)}\right)$,
         the elements of
         $F^{0}\left(a_{j}^{\left(i\right)}\right)
         \setminus \left(
         F^{0}\left(a_{1}^{\left(i\right)}\right)
         \cap F\left(a_{k_{i}}^{\left(i\right)}\right)\right)$ 
         are nested. That is, let
         \begin{gather*}
             F^{0}\left(a_{j}^{\left(i\right)}\right) \setminus 
             \left(F^{0}\left(a_{1}^{\left(i\right)}\right) \cap 
             F^{0}\left(a_{k_{i}}^{\left(i\right)}\right)\right)
             \eqdef \left\{h_1, \ldots, h_{l}\right\}.
         \end{gather*}
         Then, up to relabeling
         the elements of $F$, we have that
         \begin{gather*}
             I_{a_{j}^{\left(i\right)}}\left(h_1\right)
             \subseteq I_{a_{j}^{\left(i\right)}}\left(h_2\right)
             \subseteq \cdots
             \subseteq I_{a_{j}^{\left(i\right)}}\left(h_{l}\right), \\
             O_{a_{j}^{\left(i\right)}}\left(h_1\right)
             \subseteq O_{a_{j}^{\left(i\right)}}\left(h_2\right)
             \subseteq \cdots
             \subseteq O_{a_{j}^{\left(i\right)}}\left(h_{l}\right).
         \end{gather*}
     \end{fact}
     
     \begin{fact}
         For any two polygons
         $h \in F^{0}\left(a_{j}^{\left(i\right)}\right) \setminus 
         \left(F^{0}\left(a_{1}^{\left(i\right)}\right) \cap 
         F^{0}\left(a_{k_{i}}^{\left(i\right)}\right)\right)$ 
         and 
         $h' \in F^{0}\left(a_{j'}^{\left(i\right)}\right) \setminus 
         \left(F^{0}\left(a_{1}^{\left(i\right)}\right) \cap 
         F^{0}\left(a_{k_{i}}^{\left(i\right)}\right)\right)$,
         we have that $h$ and $h'$
         do not overlap.    
     \end{fact}

     We now prove the following
     technical lemma.

     \begin{lemma}
         Let $F \defeq \left\{h_{i}\right\}_{i =1}^{n}$ 
         be a family of polygons with
         $\omega\left(F\right) = 2$.
         Suppose that for any
         $\left(a, b\right) \in P^{0}\left(F\right)$,
         there is no $h_{i}$ such
         that $a < a_1^{\left(i\right)}
         < a_{k_{i}}^{\left(i\right)} < b$.
         Then $\chi\left(F\right) \leq 3$.
         Moreover, there exists
         a 3-coloring of $F$ such
         that for all $i, j$,
         all polygons in
         $F^{0}\left(a_{j}^{\left(i\right)}\right)$.
         We call such coloring a
         `good coloring'.
     \end{lemma}

     \begin{proof}
         By way of contradiction,
         suppose that the statement is
         false and let
         $F = \left\{h_{i}\right\}_{i = 1}^{n}$ 
         be the smallest counterexample
         to this lemma with respect
         to the order $\prec$.
         Up to relabeling the elements
         of $F$, suppose without loss
         of generality that
         $h_{1}, \ldots, h_{t}$ are
         the polygons of $F$ whose
         external segments (seen as itervals
         of the form
         $\left(a_1^{\left(i\right)}, a_{k_{i}}^{\left(i\right)}\right)$) 
         are not contained
         in the external segment of 
         any other polygon of $F$.
         We further assume that
         $a_1^{\left(1\right)} <
         a_1^{\left(2\right)} < \ldots < 
         a_1^{\left(t\right)}$.
         By the minimality of $F$, we get
         that $G\left(F\right)$ is
         connected and $h_{i} \cap h_{i+1} \neq \emptyset$
         for all $i \in \left\{1, \ldots, t-1\right\}$.
         Therefore, we have that the points
         $a^{\left(i+1, i\right)}$ and
         $b^{\left(i, i+1\right)}$ are
         well-defined for all 
         $i \in \left\{1, \ldots, t-1\right\}$.

         First, suppose that $t = 1$.
         In this case, we have $F^{0}\left(a_1^{\left(1\right)}\right)
         = \emptyset$ and
         $F^{0}\left(a_{k_1}^{\left(1\right)}\right) = \emptyset$.
         Thus, contracting
         $a_{k_{i}}^{\left(1\right)}$ in $h_1$,
         either does not change the underlying graph,
         or implies that $G\left(F\right)$ is
         disconnected. In both cases, we have a contradiction.

         We are now going to prove that
         for all $i \in \left\{1, \ldots, t -1\right\}$,
         we have either $F^{-}\left(b^{\left(i, i+1\right)}\right)
         = \emptyset$ or 
         $F^{+}\left(a^{\left(i+1, i\right)}\right)
         = \emptyset$. This is
         not the case for $t \geq 4$ since,
         in such case, we would have 
         $h_1 \in F^{-}\left(b^{\left(2, 3\right)}\right)$
         and $h_{t} \in F^{+}\left(a^{\left(3, 2\right)}\right)$.
         Thus, this would imply $t \leq 3$.

         By way of contradiction,
         suppose that there exists
         $i_0 \in \left\{1, \ldots, t-1\right\}$
         such that $F^{-}\left(b^{\left(i_0, i_0+1\right)}\right)
         \neq \emptyset$ and
         $F^{+}\left(a^{\left(i_0+1, i_0\right)}\right)
         \neq \emptyset$.
         By the minimality of $F$, 
         we have that
         $F_1 \defeq F \setminus F^{+}
         \left(a^{\left\{i_0+1, i_0\right\}}\right)$
         and
         $F_2 \defeq F \setminus F^{-}
         \left(b^{i_0,i_0+1}\right)$ 
         admit good colorings
         $f_1$ and $f_2$.
         Notice that $F_1 \cap F_2 = 
         \left\{h_{i_0}, h_{i_0+1}\right\}$.
         So, we can assume without loss
         of generality that
         $f_1\left(h_{i_0}\right) = 
         f_2\left(h_{i_0}\right) = 1$ 
         and $f_1\left(h_{i_0+1}\right) =
         f_2\left(h_{i_0+1}\right) =2$.
         This also allows us to define 
         the function $f \vcentcolon 
         F \rightarrow \left\{1, 2, 3\right\}$ 
         with $f\left(h\right) = f_1\left(h\right)$ 
         if $h \in F_1$ and 
         $f\left(h\right) = f_2\left(h\right)$ 
         if $h \in F_2$.
         By the maximality
         of $h_{i_0}$ and $h_{i_0+1}$,
         a family
         $\widetilde{F}^{0}\left(a_{j}^{\left(i\right)}\right)$
         is either entirely contained
         into $F_1$ or $F_2$.
         Thus, if $f$ is a coloring,
         it is also a good coloring.

         We now prove that $f$ is a coloring.
         Let $h_{i}, h_{i'} \in F$ be overlapping
         polygons. If both $h_{i}, h_{i'} \in F_1$ 
         or $h_{i}, h_{i'} \in F_2$, then 
         $f\left(h_{i}\right) \neq f\left(h_{i'}\right)$
         by the fact that $f_1$ and $f_2$ 
         are colorings.
         Suppose that $h_{i} \in F_1$ and
         $h_{i'} \in F_2$, then, since for no
         $\left(a, b\right) \in P^{0}\left(F\right)$ 
         and $h_{i} \in F$, we deduce that
         \begin{gather*}
             a_1^{\left(i\right)} < 
             a^{\left(i_0+1, i_0\right)} <
             a_1^{\left(i'\right)} < 
             a_{k_{i}}^{\left(i\right)} < 
             b^{\left(i_0, i_0+1\right)} < 
             a_{k_{i'}}^{\left(i'\right)}.
         \end{gather*}
         Now, since $h_{i_0+1}, h_{i'} \in 
         \widetilde{F}^{0}\left(b^{\left(i_0+1, i_0\right)}\right)$,
         and $h_{i_0+1}, h_{i'} \in F_2$,
         since $f_2$ is a good
         coloring, we have that $f\left(h_{i'}\right) =
         f\left(h_{i_0+1}\right) = 2$.
         Now, since $h_{i_0+1}$ and $h_{i}$ 
         overlap, 
         $h_{i_0+1}, h_{i} \in F_1$,
         and $f_1$ is a coloring, we get
         that $f\left(h_{i_0+1}\right) \neq
         f\left(h_{i}\right)$.
         Therefore, $f\left(h_{i}\right) \neq 
         f\left(h_{i'}\right) = 2$.
         So $f$ is a coloring and so
         a good coloring.
         This contradicts the definition
         of $F$.

         We thus conclude that
         $F^{-}\left(b^{\left(i, i+1\right)}\right) = \emptyset$ 
         or $F^{+}\left(a^{\left(i+1, i\right)}\right) = \emptyset$
         for all
         $i \in \left\{1, \ldots, t-1\right\}$ and
         $t \leq 3$.

         Suppose now that $t = 2$.
         Suppose that there exists
         $b^{\left(1,2\right)} < 
         a_{j}^{\left(2\right)} <
         a_{k_2}^{\left(2\right)}$.
         Then, since $F^{0}\left(a_{k_2}^{\left(2\right)}\right) = 
         \emptyset$, we have that 
         contracting $a_{k_2}^{\left(2\right)}$
         in $h_2$, does not change the underlying 
         graph. Which is not possible by
         the definition of $F$.
         Therefore $a^{\left(2,1\right)} =
         a_{k_2}^{\left(2\right)}$. By a
         symmetric reasoning, we can show
         $b^{\left(1, 2\right)} = a_2^{\left(1\right)}$.
         
         Consider the case of
         $F^{+}\left(a^{\left(2, 1\right)}\right) = \emptyset$.
         Since $b^{\left(1, 2\right)} =
         a_{2}^{\left(2\right)}$, $h_1$ only
         overlaps with $h_2$.
         By the minimality of $F$, 
         we get a good coloring 
         $f'$ of $F \setminus \left\{h_1\right\}$.
         We can extend $f'$ into 
         a good coloring of $F$,
         by coloring $h_1$ with 
         a color different from
         $f'\left(h_2\right)$.

         Consider the case of
         $F^{-}\left(b^{\left(1, 2\right)}\right) = \emptyset$.
         Since $a^{\left(2, 1\right)} = 
         a_{k_2}^{\left(2\right)}$,
         $h_2$ only intersecs with $h_1$.
         Now, take the outermost polygons
         overlapping with $h_1$ and
         call them $h_{i_1}, \ldots, h_{i_{l}}$ with
         \begin{gather*}
             a_1^{\left(i_1\right)} <
             a_{k_{i_1}}^{i_1} <
             a_1^{\left(i_2\right)} < 
             \ldots <
             a_{k_{i_{l - 1}}}^{\left(i_{l - 1}\right)} <
             a_1^{\left(i_{l}\right)} <
             a_{k_{i_{l}}}^{i_{l}}.
         \end{gather*}
         We can thus partition all the
         polygons overlapping with
         $h_1$ by looking at which $h_{i_{j}}$ 
         the are nested in. Denote
         such class by $N_{h_{i_{j}}}$.
         Notice that we have a good coloring
         $f'$ of $F \setminus \left\{h_2\right\}$.
         We can extend $f'$ into a colring
         $f$ of $F$ by coloring $h_2$ with
         the same color as the other polygons in
         $F^{0}\left(a_2^{\left(1\right)}\right)$.

         For the sake of simplicity,
         suppose that we have
         $f\left(h_1\right) = 1$,
         $f\left(h_{i_1}\right) = 2$ and
         $f\left(h_2\right) = 2$.
         Notice that all the polygons
         in a class $N\left(h_{i_{j}}\right)$ 
         have the same color.

         In order to obtain a good coloring
         of $F$, it suffices to color all the polygons
         overlapping with $h_1$ with color 2.
         If one exists, take the smallest index
         $i_{k}$ ($\neq i_1$) such that 
         the color of $N\left(h_{i_{k}}\right)$ 
         is different from 2. So $f\left(h_{i_{k}}\right) = 3$.
         Define $O \defeq F^{+}\left(a_{k_{i_{k-1}}}^{i_{k-1}}\right)$.
         Notice that the polygons 
         in $F \setminus O$, that overlap
         with polygons in $O$ lie in
         $O' \defeq F^{0}\left(a_{k_{i_{k-1}}}^{i_{k-1}}\right) =
         \widetilde{F}^{0}\left(a_{k_{i_{k-1}}}^{\left(i_{k-1}\right)}\right)$
         by the maximality of $h_{i_{k-1}}$.
         All polygons in $O'$ are colored
         with color 1.
         We can thus swap the colors
         2 and 3 of the polygons 
         contained in $O$, so that
         the classes $N\left(h_{i_1}\right),
         \ldots, N\left(h_{i_{k}}\right)$ are
         colored with color 2.
         We can repeat this procedure until
         all classes $N\left(h_{i_{j}}\right)$ 
         are colored with color 2.

         We now tackle the case of $t = 3$.
         If $t = 3$, we have $h_3 \in F^{+}
         \left(a^{\left(2, 1\right)}\right)$ 
         and $h_1 \in F^{-}\left(b^{\left(2, 3\right)}\right)$.
         Thus, we have that $F^{+}\left(b^{\left(2, 1\right)}\right)
         \neq \emptyset$.
         By similar arguments as those
         used in the previous case,
         the minimality of $F$ implies
         $a^{\left(2, 1\right)} = a_1^{\left(2\right)}$,
         $b^{\left(2, 1\right)} = a_2^{\left(1\right)}$,
         $a^{\left(3, 2\right)} = a_{k_3 - 1}^{\left(3\right)}$ and
         $b^{\left(2, 3\right)} = a_{k_2}^{\left(2\right)}$.

         Also, suppose that there exists
         $a_2^{\left(1\right)} < a_{j}^{\left(2\right)} <
         a_{k_1}^{\left(1\right)}$ for
         some $j > 1$. Then,
         since $F^{-}\left(b^{\left(2, 1\right)}\right) = \emptyset$, 
         contracting $a_1^{\left(2\right)}$ 
         in $h_2$ does not change the
         underlying graph, which
         contradicts the definition of $F$.
         Similarly, there is no
         $j < k_2$ $a_1^{\left(3\right)} <
         a_{j}^{\left(2\right)} <
         a_{k_3-1}^{\left(3\right)}$.
         Therefore, for all
         $1 < j < k_2$, we have
         that $a_{k_1}^{\left(1\right)} < 
         a_{j}^{\left(2\right)} < 
         a_1^{\left(3\right)}$.

         Suppose that there exists
         $1 < j < k$ such that
         $a_{k_1}^{\left(1\right)} <
         a_{j}^{\left(2\right)} <
         a_{j}^{\left(3\right)}$.
         Contract $a_{k_2}^{\left(2\right)}$ 
         in $h_2$ (call the resulting
         polygon $h_2'$)
         and get a good coloring
         $f'$ of the resulting family
         of polygons.
         Suppose without loss of
         generality that $f\left(h_1\right) = 1$,
         $f'\left(h_2'\right) = 2$.
         If $f'\left(h_3\right) \neq 2$, 
         then we can decontract $h_2'$ 
         to get a good coloring of $F$, 
         which is a contradiction.
         Let us consider the case
         $f'\left(h_3\right) = 2$.
         Define $O' \defeq F^{+}\left(a_{k_2 - 1}^{\left(2\right)}\right)$.
         Notice that all the polygons in
         $F \setminus O'$ that intersect with
         $O'$ lie in the set 
         $F^{0}\left(a_{k_2-1}^{\left(2\right)}\right) =
         \widetilde{F}^{0}\left(a_{k_2-1}^{\left(2\right)}\right)$
         by the maximality of $h_2$.
         By the fact that $f'$ is a
         good coloring, all polygons in $F^{0}\left(
         a_{k_2-1}^{\left(2\right)}\right)$
         share the same color $\gamma \in \left\{1, 3\right\}$.
         Let $\delta \in \left\{1, 3\right\} 
         \setminus \left\{\gamma\right\}$
         We can swap the colors 2 and $\delta$
         in $O'$ by preserving the good coloring.
         We can finally decontract $h_2$ to get
         a good coloring of $F$. 
         A contradiction.

         Thus, we deduce that $h_2$ is a segment.
         We get a good coloring $f'$ of
         $F \setminus \left\{h_2\right\}$.
         Suppose without loss of generality
         that $f'\left(h_1\right) = 1$.
         We define $h_{i_1}, \ldots, h_{i_{l}}$ 
         analogously as in the previous case.
         By the same argument as in the previous case,
         we can color all the sets 
         $N\left(h_{i_{j}}\right)$ with the
         same color as $N\left(h_{i_1}\right)$,
         say 2 without loss of generality.
         If after this recoloring,
         $f'\left(h_3\right) \neq 2$, 
         we can extend $f'$ into a
         good coloring of $F$ by 
         coloring $h_2$ with color 2.
         This gives a contradiction.
         We thus have $f'\left(h_3\right) = 2$.
         Let $\gamma \in \left\{1, 3\right\}$
         be the color of the polygons
         in $F^{0}\left(a_{k_{i_{l}}}^{\left(i_{l}\right)}\right)
         = \widetilde{F}^{0}\left(
         a_{k_{i_{l}}}^{\left(i_{l}\right)}\right)$.
         Let $O'' \defeq F^{+}\left(
         a_{k_{i_{l}}}^{\left(i_{l}\right)}\right)$.
         Notice that all the elements
         in $F \setminus O''$ 
         that intersect elements in $O''$
         are contained in $F^{0}\left(
         a_{k_{i_{l}}}^{\left(i_{l}\right)}\right)$.
         Let $\delta \in \left\{1, 3\right\}
         \setminus \left\{\gamma\right\}$.
         Therefore, we can swap colors
         2 and $\delta$ in $O''$
         by preserving the good coloring property.
         We can thus extend $f'$ into a
         good coloring of $F$ by
         coloring $h_2$ with color 2
         to obtain a good coloring of $F$.
         Again, a contradiction.
     \end{proof}
\end{document}
    

